webpackJsonp([1],{0:function(e,t,i){e.exports=i("NHnr")},"9khk":function(e,t){},H5Tm:function(e,t){},NHnr:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});i("j1ja");var r=i("/5sW"),a=i("3EgV"),o=i.n(a),s=i("Z60a"),n=i.n(s),c=i("C9uT"),d=i.n(c),l=(i("MfeA"),function(){function e(){n()(this,e)}return d()(e,[{key:"humanFileSize",value:function(e,t){var i=t?1e3:1024;if(Math.abs(e)<i)return e+" B";var r=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],a=-1;do{e/=i,++a}while(Math.abs(e)>=i&&a<r.length-1);return e.toFixed(1)+" "+r[a]}},{key:"isIosSafari",value:function(){return navigator.userAgent.match(/iP(od|hone|ad)/)&&navigator.userAgent.match(/AppleWebKit/)&&!navigator.userAgent.match(/(Cr|Fx|OP)iOS/)}}]),e}()),u=new l,h=function(){function e(){n()(this,e),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.MediaRecorder||(window.MediaRecorder=i("ulR3")),this.em=document.createDocumentFragment(),this.stopTracksAndCloseCtxWhenFinished=!1}return d()(e,[{key:"startRecording",value:function(){var e=this;this.audioCtx||(this.audioCtx=new AudioContext),u.isIosSafari()&&(this.processor=this.audioCtx.createScriptProcessor(2048,1,1));var t={audio:!0};return navigator.mediaDevices.getUserMedia(t).then(function(t){e._startRecordingWithStream(t)})}},{key:"_startRecordingWithStream",value:function(e){var t=this;this.micAudioStream=e,this.mediaRecorder=new MediaRecorder(this.micAudioStream),this.mediaRecorder.addEventListener("dataavailable",function(e){return t._onDataAvailable(e)}),this.mediaRecorder.addEventListener("error",function(e){return t._onError(e)}),u.isIosSafari()?this.mediaRecorder.start(null,this.audioCtx,this.processor):this.mediaRecorder.start()}},{key:"_onDataAvailable",value:function(e){if("inactive"===this.mediaRecorder.state){var t=URL.createObjectURL(e.data),i={ts:(new Date).getTime(),blobUrl:t,mimeType:e.data.type,size:e.data.size};this.processor&&(this.processor.disconnect(),this.processor=null),this.mediaRecorder.destroy&&this.mediaRecorder.destroy(),this.stopTracksAndCloseCtxWhenFinished&&(this.micAudioStream.getTracks().forEach(function(e){return e.stop()}),this.micAudioStream=null,this.audioCtx.close(),this.audioCtx=null),this.em.dispatchEvent(new CustomEvent("recording",{detail:{recording:i}}))}}},{key:"_onError",value:function(e){console.log("error",e),this.em.dispatchEvent(new Event("error")),alert("error:"+e)}},{key:"stopRecording",value:function(){this.mediaRecorder.stop()}}]),e}(),v=new h,p={name:"Test1",filters:{fileSizeToHumanSize:function(e){return u.humanFileSize(e,!0)}},data:function(){return{recordingInProgress:!1,supportedMimeTypes:[],recordings:[],cleanupWhenFinished:!1}},created:function(){var e=this;v.stopTracksAndCloseCtxWhenFinished=this.cleanupWhenFinished,v.em.addEventListener("recording",function(t){return e.onNewRecording(t)})},watch:{cleanupWhenFinished:function(e){v.stopTracksAndCloseCtxWhenFinished=this.cleanupWhenFinished}},methods:{startRecording:function(){var e=this;v.startRecording().then(function(){e.recordingInProgress=!0}).catch(function(e){console.error("Exception while start recording: "+e),alert("Exception while start recording: "+e.message)})},stopRecording:function(){v.stopRecording(),this.recordingInProgress=!1},onNewRecording:function(e){this.recordings.push(e.detail.recording)}}},m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-container",[i("v-layout",{attrs:{row:"",wrap:""}},[i("div",{staticClass:"test1"},[i("h3",[e._v("Repeatable Recording & Playback")]),i("p",[e._v("Click start/stop multiple times to create multiple recordings. Works on all modern browser/device\n        combinations, including iOS/Safari 11.2.x and newer. However, there are stability problems on iOS/Safari.")]),i("div",[i("v-btn",{attrs:{disabled:e.recordingInProgress},on:{click:e.startRecording}},[e._v("Start Recording\n        ")]),i("v-btn",{attrs:{disabled:!e.recordingInProgress},on:{click:e.stopRecording}},[e._v("Stop Recording")]),i("v-icon",{class:e.recordingInProgress?"live":""},[e._v("mic")])],1)])]),i("v-layout",{staticClass:"ml-1 mt-1",attrs:{row:"",wrap:""}},[i("v-checkbox",{attrs:{label:"Stop tracks and close audio context when recording stopped"},model:{value:e.cleanupWhenFinished,callback:function(t){e.cleanupWhenFinished=t},expression:"cleanupWhenFinished"}})],1),e.recordings.length>0?i("v-layout",{attrs:{column:"",wrap:""}},[i("h4",{staticClass:"mt-3"},[e._v("Recordings")]),e._l(e.recordings,function(t,r){return i("div",{key:t.ts},[i("v-card",[i("v-card-title",{attrs:{"primary-title":""}},[i("v-layout",{attrs:{column:"",wrap:""}},[i("div",[i("h3",[e._v("Recording #"+e._s(r+1))])]),i("div",{staticClass:"ml-3"},[i("div",[i("audio",{attrs:{src:t.blobUrl,controls:"true"}})]),i("div",[e._v("\n                size: "+e._s(e._f("fileSizeToHumanSize")(t.size))+", type: "+e._s(t.mimeType)+"\n              ")])])])],1)],1),r!==e.recordings.length-1?i("v-divider"):e._e()],1)})],2):e._e(),i("v-layout",{staticClass:"mt-5",attrs:{column:"",wrap:""}},[i("h4",[e._v("Notes\n      "),i("small",[e._v("(as of iOS 11.2.6)")])]),i("v-divider"),i("p",[e._v("\n      There are multiple valid ways to do audio recording and playback on every browser/device combination\n      "),i("i",[e._v("except")]),e._v(" iOS/Safari. I believe there are four significant issues, and only the first one seems to be well\n      known.\n    ")]),i("div",{staticClass:"ml-4"},[i("ul",[i("li",[i("strong",[e._v("Security context of the getUserMedia handler is important")]),e._v(" - "),i("br"),i("p",[e._v("\n            The most common and widely known issue issue is that the success handler of the getUserMedia is no longer\n            in the context of the user click. As a result, any audio context and processors created in the handler\n            won't work. The solution is to create the audio context and any processors before calling getUserMedia,\n            while still in the user click handler context. Then once getUserMedia provides the stream,\n            use the previously created constructs to setup the graph and start recording.\n          ")])]),i("li",[i("strong",[e._v("Multiple recordings require new audio streams")]),e._v(" - "),i("br"),i("p",[e._v("\n            There are a number of demos that work for the first recording on iOS/Safari, that then fail with empty\n            audio on subsequent recordings until page is reloaded. The reason is that after stopping recording and\n            extracting playable blob, the next recording requires a new AudioStream. This AudioStream can come\n            from another call to getUserMedia (which won't prompt user after the first time), or potentially, by\n            cloning the existing audio stream.\n          ")])]),i("li",[i("strong",[e._v("Red recording bar indicator")]),e._v(" - "),i("br"),i("p",[e._v("\n            After granting permission to microphone, iOS/Safari will show a red bar notification anytime user switches\n            away from the tab where permission was granted. To clear this bar, the recording stream's tracks can be\n            stopped after recording is finished. This can be tested with the checkbox above. Stopping the tracks and\n            closing the audio context is straightforward and works well, except for this last issue:\n          ")])]),i("li",[i("strong",[e._v("A sleep/lock/switch event can easily break things, is not detectable, and is not easily\n          recoverable")]),e._v(" - "),i("br"),i("p",[e._v("\n            To see this, make a recording and verify it plays. Switch to mail app, then back to safari and make/verify\n            another recording. As long as red bar/microphone is still visible, it generally works. Then, check the\n            option to stop tracks and close audio context. Make another recording and verify. Switch to mail app and\n            back and try to make another recording. Most of the time the recording will appear to work, but the audio\n            will be silent. As far as I can tell, there is no way to detect this, and there is no way to recover\n            without loading a new tab or force quitting Safari.\n          ")]),i("p",[i("em",[e._v("If")]),e._v(" the tracks are not stopped and so the red bar/icon remains, then this occurs much less\n            frequently. Of course, that means the red bar is constantly visible though. And even then, starting\n            another app that uses the microphone will almost always break things again. I have not been able to find a\n            way to detect, much less, programmatically fix things, when this occurs. My assumption is that the\n            underlying issue is due to low level iOS/Safari bugs, and not in how this code is setting things up.")])])])])],1),i("v-layout",{attrs:{column:"",wrap:""}},[i("h4",{staticClass:"mt-3"},[e._v("Relevant")]),i("v-divider"),i("div",{staticClass:"ml-4"},[i("ul",[i("li",[i("a",{attrs:{href:"https://github.com/muaz-khan/RecordRTC/issues/324"}},[e._v("https://github.com/muaz-khan/RecordRTC/issues/324")])]),i("li",[i("a",{attrs:{href:"https://github.com/ai/audio-recorder-polyfill/issues/4"}},[e._v("https://github.com/ai/audio-recorder-polyfill/issues/4")])]),i("li",[i("a",{attrs:{href:"https://github.com/danielstorey/webrtc-audio-recording"}},[e._v("https://github.com/danielstorey/webrtc-audio-recording")])])])])],1),i("v-layout",{attrs:{column:"",wrap:""}},[i("h4",{staticClass:"mt-3"},[e._v("Source")]),i("v-divider"),i("div",{staticClass:"ml-4"},[i("ul",[i("li",[i("a",{attrs:{href:"https://github.com/kaliatech/web-audio-recording-tests/blob/master/src/views/Test1.vue"}},[e._v("src/views/Test1.vue")]),i("ul",{staticClass:"ml-3"},[i("li",[e._v("Primarily: "),i("a",{attrs:{href:"https://github.com/kaliatech/web-audio-recording-tests/blob/master/src/shared/RecorderService.js"}},[e._v("src/shared/RecorderService.js")])])])]),i("li",[i("a",{attrs:{href:"https://github.com/kaliatech/audio-recorder-polyfill/commit/79928f917fab99f8b458ef04ca816fbc905e03c5"}},[e._v("https://github.com/kaliatech/audio-recorder-polyfill/tree/issue-4-ios-safari-hack")]),e._v("\n          - Hacked for iOS/Safari support\n        ")])])])],1)],1)},g=[],f=i("XyMi");function w(e){i("9khk")}var b=!1,_=w,y="data-v-1652e9ee",k=null,x=Object(f["a"])(p,m,g,b,_,y,k),S=x.exports,C={name:"app",components:{Test1:S},data:function(){return{drawer:!1}}},R=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("v-app",[i("v-navigation-drawer",{attrs:{fixed:"",temporary:"",app:""},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}},[i("v-list",{attrs:{dense:""}},[i("v-list-tile",{attrs:{to:"/"}},[i("v-list-tile-action",[i("v-icon",[e._v("home")])],1),i("v-list-tile-content",[i("v-list-tile-title",[e._v("Home")])],1)],1),i("v-list-tile",{attrs:{to:"/diagnostics"}},[i("v-list-tile-action",[i("v-icon",[e._v("mic")])],1),i("v-list-tile-content",[i("v-list-tile-title",[e._v("Diagnostics")])],1)],1),i("v-list-tile",{attrs:{to:"/test1"}},[i("v-list-tile-action",[i("v-icon",[e._v("mic")])],1),i("v-list-tile-content",[i("v-list-tile-title",[e._v("1 - Repeatable Recording")])],1)],1),i("v-list-tile",{attrs:{href:"https://github.com/kaliatech/web-audio-recording-tests"}},[i("v-list-tile-action",[i("v-icon",[e._v("code")])],1),i("v-list-tile-content",[i("v-list-tile-title",[e._v("View on Github")])],1)],1)],1)],1),i("v-toolbar",{attrs:{color:"grey",dark:"",fixed:"",app:""}},[i("v-toolbar-side-icon",{on:{click:function(t){t.stopPropagation(),e.drawer=!e.drawer}}}),i("v-toolbar-title",[e._v("Web Audio Tests")]),i("v-spacer"),i("a",{attrs:{href:"https://github.com/kaliatech/web-audio-recording-tests"}},[i("v-icon",{attrs:{large:""}},[e._v("code")])],1)],1),i("v-content",[i("v-container",{staticClass:"scroll-container",attrs:{fluid:""}},[i("div",[i("router-view")],1)])],1)],1)],1)},T=[];function A(e){i("OYMq")}var M=!1,O=A,E=null,P=null,B=Object(f["a"])(C,R,T,M,O,E,P),W=B.exports,F=i("/ocq"),I={name:"Home",components:{},data:function(){return{}}},D=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-container",[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{md3:""}}),i("v-flex",{attrs:{md6:""}},[i("div",{staticClass:"text-xs-center home--menu"},[i("p",[e._v("\n            Tests to verify functionality of web audio api across all browsers. Particularly on iOS/Safari 11.2.x as it\n            is very strict on security context and has "),i("del",[e._v("bugs")]),i("em",[e._v("special features")]),e._v(".\n          ")]),i("div",[i("v-btn",{attrs:{color:"info",to:"/diagnostics"}},[e._v("Browser Diagnostics")])],1),i("div",[i("v-btn",{attrs:{color:"info",to:"/test1"}},[e._v("1 - Recording and Playback")])],1)])]),i("v-flex",{attrs:{md3:""}})],1)],1)},j=[];function z(e){i("uCOA")}var H=!1,U=z,q=null,L=null,N=Object(f["a"])(I,D,j,H,U,q,L),$=N.exports,Y=i("Oy1H"),G=i.n(Y),Z={name:"Diagnostics",data:function(){return{supportedMimeTypes:[],mediaRecorderOrigStr:G()(window.MediaRecorder),mediaRecorderPoly:""}},computed:{audioContextStr:function(){return G()(window.AudioContext)},webkitAudioContextStr:function(){return G()(window.webkitAudioContext)}},created:function(){var e=["audio/vorbis","audio/webm","audio/webm;codecs=opus","audio/aac","audio/mpeg","audio/mp4","audio/x-wav","audio/wav","video/quicktime","video/webm","video/webm;codecs=vp8","video/webm;codecs=vp9","video/webm;codecs=h264","video/mp4"],t=i("ulR3");for(var r in this.mediaRecorderPoly=!t.notSupported,e)t&&t.isTypeSupported?this.supportedMimeTypes.push({name:e[r],supported:t.isTypeSupported(e[r])}):this.supportedMimeTypes.push({name:e[r],supported:"-"})},methods:{}},K=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"mb-3"},[i("v-layout",{attrs:{row:""}},[i("h2",[e._v("Browser Diagnostics")])]),i("v-layout",{staticClass:"mt-3 mb-3",attrs:{row:""}},[i("h4",[e._v("Web Audio Support")])]),i("v-layout",{staticStyle:{"padding-left":"1em"},attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs12:""}},[i("ul",[i("li",[i("span",{staticClass:"lbl"},[e._v("AudioContext")]),e._v(" : "),i("span",{staticClass:"val"},[e._v(e._s(e.audioContextStr))])]),i("li",[i("span",{staticClass:"lbl"},[e._v("webkitAudioContext")]),e._v(" : "),i("span",{staticClass:"val"},[e._v(e._s(e.webkitAudioContextStr))])]),i("li",[i("span",{staticClass:"lbl"},[e._v("MediaRecorder")]),e._v(" : "),i("span",{staticClass:"val"},[e._v(e._s(e.mediaRecorderOrigStr))])]),i("li",[i("span",{staticClass:"lbl"},[e._v("MediaRecorder(Polyfilled)")]),e._v(" : "),i("span",{staticClass:"val"},[e._v(e._s(e.mediaRecorderPoly))])])])])],1),i("v-layout",{staticClass:"mt-3",attrs:{row:""}},[i("h4",[e._v("Supported MediaRecorder Mime Types")])]),i("v-layout",{staticStyle:{"padding-left":"1em"},attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs12:""}},[i("ul",e._l(e.supportedMimeTypes,function(t){return i("li",{key:t.name},[i("span",{staticClass:"lbl"},[e._v(e._s(t.name))]),e._v(" : "),i("span",{staticClass:"val"},[e._v(e._s(t.supported))])])}))])],1),i("v-layout",{staticClass:"mt-3",attrs:{row:""}},[i("h4",[e._v("References and Demos")])]),i("v-layout",{staticStyle:{"padding-left":"1em"},attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs12:""}},[i("ul",[i("li",[i("a",{attrs:{href:"https://higuma.github.io/web-audio-recorder-js/"}},[e._v("https://higuma.github.io/web-audio-recorder-js/")]),e._v(" -\n          Doesn't work on iOS/Safari. Didn't seem to work in Edge either, but not clear why.\n        ")]),i("li",[i("a",{attrs:{href:"https://webrtc.github.io/samples/src/content/devices/input-output/"}},[e._v("https://webrtc.github.io/samples/src/content/devices/input-output/")]),e._v("\n          - Doesn't work on iOS/Safari or Edge.\n        ")])])])],1)],1)},V=[];function J(e){i("H5Tm")}var X=!1,Q=J,ee="data-v-7f7e6e92",te=null,ie=Object(f["a"])(Z,K,V,X,Q,ee,te),re=ie.exports;r["a"].use(F["a"]);var ae=new F["a"]({mode:"hash",routes:[{path:"/",name:"home",component:$},{path:"/diagnostics",name:"diagnostics",component:re},{path:"/test1",name:"test1",component:S}]}),oe=ae,se=i("IHMs"),ne=i.n(se);r["a"].use(o.a,{theme:{primary:ne.a.grey.darken1,secondary:ne.a.grey.lighten4,accent:ne.a.grey.base}}),r["a"].config.productionTip=!1,new r["a"]({router:oe,render:function(e){return e(W)}}).$mount("#app")},OYMq:function(e,t){},uCOA:function(e,t){}},[0]);
//# sourceMappingURL=app.9c867ae9.js.map